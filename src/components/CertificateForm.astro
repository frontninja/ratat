<div class="md:max-w-2xl mx-auto bg-white px-6 py-4 md:px-16 md:py-12 text-styles">
    <h1>
        Оставьте заявку на сертификат
    </h1>
    <p class="text-sm text-secondary mb-5">
        Время ответа на заявку может составить более 7 дней. Приносим
        извинения за столь долгое ожидание.
    </p>
    <form id="form" class="flex flex-col gap-5">
        <div class="flex flex-col gap-3">
            <input
                    class="form__input form__input--name"
                    type="text"
                    name="name"
                    id="name"
                    required
                    placeholder="Как к вам обращаться"
            />
            <input
                    class="form__input form__input--tel"
                    type="tel"
                    name="tel"
                    id="tel"
                    required
                    placeholder="Телефон"
            />
            <input
                    class="form__input form__input--email"
                    type="email"
                    name="email"
                    id="email"
                    placeholder="Электронная почта"
            />
        </div>
        <div class="flex flex-col gap-1">
            <button
                    type="submit"
                    class="text-sm bg-accent text-white flex justify-center items-center h-[60px] min-w-[300px] xl:min-w-[350px] transition hover:shadow-button hover:shadow-accent"
            >Свяжитесь со мной</button
            >
            <span class="text-sm text-secondary"
            >Оставляя заявку, я настоящим соглашаюсь <br> с&nbsp;<a
                    class="text-accent underline"
                    href="/privacy/"
            >Политикой&nbsp;оператора в&nbsp;отношении обработки
                        персональных данных</a
            > и&nbsp;<a class="text-accent underline" href="/agreement/"
            >Пользовательским оглашением</a
            >
                </span>
        </div>
    </form>
</div>
<script>
    import Inputmask from 'inputmask';
    import toastr from 'toastr'
    import {getTrafficSource} from "../scripts/getTrafficSource";

    var selector = document.getElementById("tel");
    var modal = document.getElementById("formModal");
    var im = new Inputmask(); // Удаление применения маски
    im.mask(selector);
    var selector = document.getElementById("tel");

    selector.addEventListener("input", function (e) {
        var inputValue = e.target.value;
        var numberPattern = /^\d*$/;
        if (!numberPattern.test(inputValue)) {
            e.target.value = inputValue.replace(/\D/g, "");
        }
        if (inputValue.length > 20) {
            e.target.value = inputValue.slice(0, 20);
        }
    });

    const inputs: HTMLInputElement[] = [
        document.getElementById("name") as HTMLInputElement,
        document.getElementById("tel") as HTMLInputElement,
        document.getElementById("email") as HTMLInputElement,
    ];
    const form = document.getElementById("form") as HTMLFormElement;


    form.onsubmit = function (e) {
        e.preventDefault();
        if (inputs.every((input) => input?.checkValidity())) {
            const data = new URLSearchParams();
            data.append("name", inputs[0].value);
            data.append("tel", inputs[1].value);
            data.append("email", inputs[2].value);
            data.append("program", "certificate");
            data.append('source', 'ratata');
            data.append('trafficSource', getTrafficSource());

            const fakeFetch = new Promise(res => res('all good'))
            fetch("https://autopragmat.ru/api/v1/send-order/", {
                method: "POST",
                body: data,
            }).then(() => {
                modal.style.display = "none";
                toastr.success("Заявка успешно отправлена");
                form.reset();
            }).catch(() => {
                toastr.error("Произошла ошибка");
            });
        }
    };
</script>
