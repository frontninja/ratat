<div class="max-w-2xl mx-auto bg-white px-16 py-12">
    <h1 class="text-xl lg:text-2xl xl:text-3xl font-bold uppercase font-display italic">
        Оставьте заявку
    </h1>
    <p class="text-sm text-secondary mb-5">
        Время ответа на заявку может составить более 2 дней. Приносим
        извинения за столь долгое ожидание.
    </p>
    <form id="form" class="flex flex-col gap-5">
        <div class="flex flex-col gap-3">
            <input
                    class="form__input form__input--name"
                    type="text"
                    name="name"
                    id="name"
                    required
                    placeholder="Как к вам обращаться"
            />
            <input
                    class="form__input form__input--tel"
                    type="tel"
                    name="tel"
                    id="tel"
                    required
                    placeholder="Телефон"
            />
            <input
                    class="form__input form__input--email"
                    type="email"
                    name="email"
                    id="email"
                    placeholder="Электронная почта"
            />
          <div class="form__select-wrapper">
            <select name="program" id="program" class="form__select">
              <option value="" selected disabled hidden>Выберите программу</option>
              <option value="Safety">Safety</option>
              <option value="Skill">Skill</option>
              <option value="Drift">Drift</option>
              <option value="Sport">Sport</option>
              <option value="All">Полный курс (4 занятия)</option>
              <option value="Certificate">Подарочный сертификат</option>
            </select>
          </div>
        </div>
        <div class="flex flex-col gap-1">
            <button
                    type="submit"
                    class="text-sm bg-accent text-white flex justify-center items-center h-[60px] min-w-[300px] xl:min-w-[350px] transition hover:shadow-button hover:shadow-accent"
            >Свяжитесь со мной
            </button
            >
            <span class="text-sm text-secondary"
            >Оставляя заявку, я настоящим соглашаюсь <br> с&nbsp;<a
                    class="text-accent underline"
                    href="/privacy/"
            >Политикой&nbsp;оператора в&nbsp;отношении обработки
                        персональных данных</a
            > и&nbsp;<a class="text-accent underline" href="/agreement/"
            >Пользовательским оглашением</a
            >
                </span>
        </div>
    </form>
</div>
<style>
  .form__select {
      @apply px-5 h-7 text-sm bg-no-repeat bg-input text-secondary bg-[#ebebeb] border border-solid border-white appearance-none w-full
  }
  .form__select-wrapper {
    width: 100%;
    position: relative;
  }
  .form__select-wrapper::after {
    position: absolute;
    content: "";
    display: block;
    top: calc(50% - 3px);
    right: 10px;
    width: 0;
    height: 0;
    border: 6px solid transparent;
    border-color: #46a6ff transparent transparent transparent;
  }
</style>
<script>
    import Inputmask from 'inputmask';
    import toastr from 'toastr'

    var selector = document.getElementById("tel");

    var im = new Inputmask(); // Удаление применения маски
    im.mask(selector);
    var selector = document.getElementById("tel");

    selector.addEventListener('input', function (e) {
        var inputValue = e.target.value;
        var numberPattern = /^\d*$/;
        if (!numberPattern.test(inputValue)) {
            e.target.value = inputValue.replace(/\D/g, '');
        }
        if (inputValue.length > 20) {
            e.target.value = inputValue.slice(0, 20);
        }
    });

    const inputs: HTMLInputElement[] = [document.getElementById('name') as HTMLInputElement, document.getElementById('tel') as HTMLInputElement, document.getElementById('email') as HTMLInputElement];
    const program = document.getElementById('program') as HTMLSelectElement;
    const form = document.getElementById('form') as HTMLFormElement;
    var modal = document.getElementById("formModal");
    var formSubmit: HTMLElement = document.querySelector(
        ".form__submit"
    ) as HTMLElement;

    form.onsubmit = function (e) {
        e.preventDefault();
        if (inputs.every(input => input?.checkValidity())) {
            const data = new URLSearchParams();
            data.append('name', inputs[0].value);
            data.append('tel', inputs[1].value);
            data.append('email', inputs[2].value);
            data.append('program', program.value);
            data.append('source', 'ratata');
            fetch('https://autopragmat.ru/api/v1/send-order/', {
                method: 'POST',
                body: data,
            })
                .then(() => {
                    modal.style.display = "none";
                    toastr.success('Заявка успешно отправлена');
                    form.reset();
                });
        }
    };
</script>
